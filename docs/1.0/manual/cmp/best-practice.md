# 最佳实践



## 告警实践

当集群投入生产后，您不可避免地要时刻关注集群的整体状况，并希望在集群发生异常时得到通知，此时，就轮到告警发挥作用了。

在**运维告警/告警策略**中，我们以及内置了许多告警策略，其中的各种配置项包括告警阈值，我们已根据历史经验默认预设好了，大部分情况下，您可以选择直接使用。

然而，由于实际业务千变万化，您也许不得不亲自来配置告警规则，选择合适的阈值以及相关聚合函数。下文，我将针对集群运维方面，为您提供我们的建议。

### 节点

对于机器节点，我们一般着重关注其资源的使用情况、节点状态等

#### 状态

机器宕机是最值得关注的，机器一旦意外宕机将极有可能影响服务，因此您首先需要设置的就是机器宕机告警。

#### 平均负载

平均负载是指单位时间内，系统处于可运行状态和不可中断状态的平均进程数，也就是平均活跃进程数，和 CPU 使用率并没有直接关系。其分为1、5、15分钟内的平均负载，一般来说我们取5分钟的负载。

您可以理解为系统的整体繁忙情况，负载越大系统越繁忙，各种资源都比较紧缺。默认情况下，我们将其设置为20，您需要根据实际节点上CPU的个数调整。

> 一般经验：单个CPU的平均负载不得高于70%

#### CPU

一般我们只需关注CPU使用率，它衡量了一段时间内CPU用在用户进程、内核进程以及中断处理的占比，CPU高并非一定是坏事，它只是说明系统正在全力工作。

然而，当CPU使用率长时间保持高位时，我们就需要开始关注了。

> 一般经验：5分钟内，CPU使用率不得高于95%

#### 内存

在机器层面，我们一般只需关注内存使用率，它表示了机器整体的内存资源的使用情况，您可以根据您对系统稳定性的诉求来设置预置，我们一般认为不应高于80%

#### 磁盘

这里，我们一般需要关注磁盘使用率以及磁盘Inode使用率情况，磁盘使用率不应高于86%，磁盘Inode使用率不应高于85%

## 集群组件

除了需要关注机器节点的情况，您还需要关注系统组件的状况。大部分情况下，Erda都是运行在Kubernetes集群之上的，因此，下文将以Kuberntes集群为例。

### 状态

Kubernetes系统组件的状态最为重要，甚至重要程度偶尔的节点宕机。我们会采集组件退出的事件，以及实例是否满足逾期个数等，因此您应当开启Kubernetes的相关告警策略

#### 资源使用

同样，组件实例的资源使用情况也会影响组件稳定性，例如内存不够导致OOM，CPU不够导致处理缓慢、卡死等。默认配置已经很保守了，您可以根据实际情况调整阈值。

### 其他

其他预置告警策略，主要涉及Erda自身组件以及相关中间件，一般无需开启。

