# 扩缩容

扩缩容主要是通过向集群中添加或删除机器来实现，以满足业务动态资源需求，添加的机器可以是虚拟机（包含云主机）、物理机等。

## 添加机器
当集群资源不足时，需要往集群中添加机器，当前主要有如下两种场景：
* 阿里云容器服务集群添加机器
* 一般集群添加机器

### 阿里云容器服务集群添加机器
对于阿里云容器服务集群，添加机器推荐步骤如下：
* 阿里云界面集群节点扩容: 阿里云容器服务集群（ACK） -> 节点 -> 集群扩容

![](http://terminus-paas.oss-cn-hangzhou.aliyuncs.com/paas-doc/2021/07/05/c5ef4715-2067-48d2-a25f-68c52fbfdcf9.jpg)

* Erda 界面：添加机器，添加阿里云容器服务集群（ACK）扩容出的节点
> 入口：多云管理平台 -> 资源管理 -> 集群管理 -> 操作（添加机器）

::: tip
只有通过 Erda 界面添加完机器，这些机器才会被 Erda 纳管
:::

添加机器时还需注意以下两点：
* 添加机器时可以打上合适的机器标签，具体请参见 [机器标签](./cluster-node-labels.md)
* 添加机器时数据磁盘设备参数可选，如果有数据盘，则填写正确的盘符；若无，则忽略

若是阿里云容器服务集群，但是客户提供的却是直接购买的云主机 ECS，则首先需要在阿里云容器服务界面，将ECS 加入到阿里云容器服务集群

> 入口：阿里云界面容器服务集群 -> 节点 -> 添加已有节点

![](http://terminus-paas.oss-cn-hangzhou.aliyuncs.com/paas-doc/2021/07/05/ccb093df-3bae-469d-8da9-e0cc2dea5b56.png)

### 一般集群添加机器
对于非阿里云容器服务集群，则直接在 Erda 界面，添加机器即可

## 机器下线
平台支持在线进行机器下线的操作，若是机器下线，应先从 Erda 界面下线，再真正释放下线，否则 Erda 会误以为机器宕机，产生误告警。
在机器正式下线前需要完成以下事前准备工作：

* 为防止业务影响和业务数据的丢失，需要下线的机器上不能有 addon 服务还运行着，如有需要手动进行迁移后才能进行下线。
* 关键功能运行的节点不能下线，具体包含 lb 、master、cassandra、es、kafka、nexus、gittar 标签的宿主机。

> 机器下线入口：多云管理平台 -> 集群总览 -> 机器列表（操作：下线）



