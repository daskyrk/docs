# 告警策略

在多云管理平台下运维告警下的告警策略是至关重要的一部分，多云管理中的运维告警下的所以其他功能的实现都是基于告警策略。

当用户需要针对某个资源对象的某个状态发送告警时，需要创建告警策略。创建告警策略触发告警有助于用户及时了解资源使用情况和处理突发事件。

## 监控告警
目前支持的监控项包括：
### 微服务
- API网关实例CPU使用率异常
- API网关实例内存使用率异常
- 注册中心实例CPU使用率异常
- 注册中心实例内存使用率异常

### 机器
- 机器时钟一致性异常告警
- 机器CPU
- 机器磁盘
- 磁盘Inode异常告警
- 机器磁盘IO
- 机器Load5
- 网盘
- 网盘容量使用量异常告警
- 机器宕机

### 扩展中间件
- MySQL SLAVE DELAY ALERT
- MySQL SLAVE SYNC ALERT

### 平台中间件
- 平台中间件Cassandra GC次数异常
- 平台中间件Cassandra GC耗时异常
- 平台中间件实例CPU状态
- 平台中间件异常退出
- 平台中间件实例内存状态
- 平台中间件实例Ready状态异常
- 平台中间件Elasticsearch GC次数异常
- 平台中间件Elasticsearch GC耗时异常
- 平台中间件Kafka GC次数异常
- 平台中间件Kafka GC耗时异常
- 平台中间件kafka消费堆积

### 平台组件
- 平台组件实例CPU状态
- 平台组件异常退出
- 平台组件实例内存状态
- 平台组件实例Ready状态异常
- 平台组件Flink任务checkpoint延迟异常告警
- 平台组件Flink吞吐量异常告警
- 平台组件网盘不可用告警
- 平台组件日志存储保护器状态变化

### Kubernetes
- kubernetes组件实例CPU状态
- kubernetes组件异常退出
- kubernetes组件实例内存状态
- kubernetes组件实例Ready状态异常
- kubernetes节点异常

### 项目中间件
- ElasticSearch实例CPU使用率异常告警
- Elasticsearch实例内存使用率异常告警
- MySQL实例CPU使用率异常告警
- MySQL实例内存使用率异常告警
- MySQL实例主从同步异常告警
- redis实例内存使用率异常告警

## 创建告警策略
首先我们需要在多云管理平台下创建一个告警策略，指定需要检测的集群、告警规则、沉默周期、选择群组等，下面介绍创建的步骤。
进入到组织到多云管理平台下，在应用中心中点击运维告警 -> 告警策略 -> 新建策略。

### 告警名称
用户在创建告警策略时需要填写该策略的名称用于区别不同的告警策略，告警策略的名字不可重复，否则创建失败。

### 告警集群
用户在创建告警策略时需要选择告警集群，该集群列表是通过组织ID查询得到的，该集群列表限制了可供用户选择的集群，该字段为必选项，可多选，如图：
![告警集群](http://terminus-paas.oss-cn-hangzhou.aliyuncs.com/paas-doc/2021/08/03/9245ba6e-c48a-477d-87f5-89067686a0e4.png)

### 告警规则
在选择告警告警规则时可对支持对监控项选择多条告警规则，任何一条满足条件都会触发告警。用户在选择告警规则时有两种方式：
1. 点击`类型模版`，用户选择需要的模版之后告警规则中会添加该模版中所有的告警规则。如图选择机器模版之后，告警规则中会有以下9条告警规则。
![机器模版](http://terminus-paas.oss-cn-hangzhou.aliyuncs.com/paas-doc/2021/08/03/089ac88e-6014-4ecd-972f-759b199a4be7.png)
2. 点击`添加规则`,用户可以单独选择想要告警规则，点击添加规则后会随机添加一条告警规则，用户若想改变告警规则需要点击该规则的下拉列表，该列表中包含了多云管理平台下所有类型模版的告警规则。如图所示：
![告警规则](http://terminus-paas.oss-cn-hangzhou.aliyuncs.com/paas-doc/2021/08/03/385e0f9b-fd12-4b5a-9e85-dce01d240c7e.png)

### 沉默周期
在创建告警策略时，沉默周期为必选字段。为了避免发送告警太过频繁该字段表示相同的告警策略中的相同的告警规则所触发的告警之间相隔的时间，目前支持的沉默周期有5分钟、10分钟、15分钟、30分钟、60分钟、3小时。

### 沉默周期策略
沉默周期策略是与沉默周期配合使用的，目前系统提供的沉默周期策略只有两个值分别是固定和翻倍。
- 固定：如果用户在沉默周期选的是5分钟，而且沉默周期策略是固定则相同的告警策略中相同的告警规则触发的规则之间的时间间隔将一直是5分钟。
- 翻倍：如果用户在沉默周期选的是5分钟，而沉默周期策略选的是个翻倍，则相同的告警策略中的相同的告警规则触发的告警之间的时间间隔会翻倍，如5，10，20，40...

### 选择群组
用户所选择的群组表示用户希望产生的告警会发往哪个对象，用户可以在管理中心下组织设置 -> 通知组中创建通知组，在创建通知组时可以选择不同的通知对象。
如图所示：
![新建群组](http://terminus-paas.oss-cn-hangzhou.aliyuncs.com/paas-doc/2021/08/03/dbe0d32d-a35e-4c13-82b8-caa0d9fa3ce1.png)
