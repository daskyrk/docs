# 自定义告警

多云管理平台下的创建告警策略可选择告警规则不仅可以选择系统提供的告警规则，还可以选择自定义告警规则，自定义告警规则是由用户自己创建的。

当用户在多云管理平台下创建告警策略选择告警规则都不符合需求的情况下可以选择创建自定义告警，在创建自定义告警规则时需要定义触发规则和消息模版。

## 告警指标
目前支持的自定义告警指标包括：
- 机器
- 平台资源
- 项目资源
- 云产品
- Log Metrics
- 其他

## 创建自定义告警
在多云管理平台创建自定义告警的步骤是:进入到组织 -> 应用中心 -> 多云管理平台 -> 运维告警 -> 自定义告警

### 名称
用户在创建自定义告警规则时需要填写该告警规则的名称用于区别不同的自定义告警规则，自定义告警规则的名字不可重复，否则创建失败。

### 触发规则定义

#### 周期
该字段的值表示告警指标计算的时间窗口，以分钟为单位。

#### 指标
描述了告警需要读取的metric event指标，用户可从下拉列表中自行选择，该字段只能单选，不可多选，如图所示:
![自定义告警指标](http://terminus-paas.oss-cn-hangzhou.aliyuncs.com/paas-doc/2021/08/03/db33571e-bec1-4a55-ab5c-3a2e53ba7fd0.png)

#### 过滤规则
用户可以添加零条或者多条过滤规则，过滤规则描述了如何过滤告警数据,创建好的过滤规则会以json的形式保存在数据库中,在进行告警数据匹配时，键对应的值从metric的tag中获取

#### 分组规则
描述了告警指标的分组维度，该值从metric中的tag中读取。该字段为非必选字段

#### 字段规则
根据用户所选的指标的不同，在创建字段规则可选择的字段也不同,用户在选择好字段规则之后，需要自行填写别名，即用户设置一个用来表示该字段的别称；选择聚合规则，该聚合规则描述在时间窗口内数据如何聚合；用户自行选择如何进行操作，该字段描述了窗口结束后的聚合结果和预期值的比较方式；需要用户填写的默认阈值为指标字段计算的预期阈值。设置好的触发规则定义示例如图所示：
![触发规则定义](http://terminus-paas.oss-cn-hangzhou.aliyuncs.com/paas-doc/2021/08/03/736849fe-247a-4463-9c6d-8f31437b9a02.png)

### 消息模版定义

#### 可选通知方式
该字段表示告警的通知方式，为可选字段，如果不选默认值为ticket

#### 消息标题规则
该字段表示用户设置的消息模版在发送告警的模版标题

#### 消息内容规则
用户自定义告警模版，用于发送告警所显示的内容，模版样例中的占位符字段从metric中取，填写时可参照模版样例如图：
![模版样例](http://terminus-paas.oss-cn-hangzhou.aliyuncs.com/paas-doc/2021/08/03/224a7322-d050-4772-8f7a-d4e1d2b43522.png)

用户配置好自定义告警规则后在告警策略中可以进行选择使用如图所示：
![自定义告警规则](http://terminus-paas.oss-cn-hangzhou.aliyuncs.com/paas-doc/2021/08/03/d3c1c1e5-cb25-4b37-8eb4-338ed24feba2.png)

